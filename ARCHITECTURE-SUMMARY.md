# Architecture & Performance Summary

**Phase 1** (detection) and **post-upgrade** state.

---

## Router

| Check | Result |
|-------|--------|
| **App Router** (`/app` directory) | **No** — 0 files under `app/` |
| **Pages Router** (`/pages` directory) | **Yes** — 24 files under `pages/` and `src/pages/` |

**Conclusion:** Pages Router only. No App Router.

---

## Build & Export

| Check | Result |
|-------|--------|
| **`output: 'export'` in next.config.js** | **Yes** — Static export enabled (writes to `out/` for Netlify) |
| **images** | `unoptimized: true` — Next.js image optimization **disabled** (required for static export without custom loader) |

---

## Images

| Check | Result |
|-------|--------|
| **next/image used in app** | **No** — Only referenced in `next-env.d.ts` and a markdown doc |
| **Custom image component** | **Yes** — `OptimizedImage` (`src/components/ui/optimized-image.tsx`) |
| **Implementation** | Renders native `<img>`; uses Netlify Image CDN when `origin` is Netlify/ancel.co.ke (AVIF/WebP via `/.netlify/images?url=...&fm=avif|webp`). Lazy-loads via Intersection Observer; supports `priority`, `sizes`, `width`/`height`. |

---

## Fonts

| Check | Result |
|-------|--------|
| **Google Fonts via `<link>`** | **Yes** — In `pages/_document.tsx`: preconnect, preload, stylesheet for Inter (300;400;500;600;700) |
| **next/font** | **No** — Not used anywhere |

Fonts are render-blocking (stylesheet loaded in `<Head>`).

---

## Dynamic Routes & SSG

| Route | getStaticPaths | getStaticProps | Status |
|-------|----------------|----------------|--------|
| `/case-studies/[slug]` | Yes (18 slugs from `case-studies.json`) | Yes (`slug` prop) | **SSG** |
| `/developer-journal/[slug]` | Yes (title-to-slug from `blog.json`) | Yes (`slug` prop) | **SSG** |

**Conclusion:** Dynamic routes are statically generated (no client-only routes).

---

## JSON-LD Structured Data

| Check | Result |
|-------|--------|
| **Implemented** | **Yes** |
| **Location** | `src/components/seo/schemas.ts` + usage in SEOHead, CaseStudyDetailPage, BlogDetailPage, header, breadcrumb, case-studies index |
| **Schemas present** | Person, ProfilePage, SoftwareApplication, SoftwareSourceCode, BlogPosting, CreativeWork, TechArticle, WebSite, Organization, BreadcrumbList, ItemList (portfolio/nav) |
| **Injection** | `<script type="application/ld+json">` via `dangerouslySetInnerHTML` in SEOHead and other components |

---

## LCP Element

- **Primary LCP:** Hero section text (h1 + subline + paragraph) in `src/components/sections/hero.tsx`.
- **No hero image** — Hero is text-only; LCP is text (already optimized for first-frame paint in static variant).
- **First images below fold:** About section profile image (`priority`), TodaysHighlights (`priority={index < 2}`), case-studies grid (`priority={index < 2}`). Multiple components use `priority`; only one above-the-fold image should have it (About profile or first highlight).

---

## SEO (Existing)

- **Canonical:** Set in SEOHead and SEO component.
- **Open Graph:** og:title, og:description, og:image, og:url, og:type in SEOHead.
- **Twitter:** twitter:card, twitter:title, etc. in SEOHead.
- **Sitemap/robots:** `generate-seo` script produces sitemap.xml, robots.txt, sitemap-for-ai.json.

---

## Summary Table

| Item | Status |
|------|--------|
| Router | Pages only |
| output: 'export' | Enabled |
| next/image | Not used (custom OptimizedImage) |
| Image optimization | Disabled in Next (Netlify CDN used at runtime) |
| Fonts | Google `<link>` (blocking); no next/font |
| Dynamic routes | SSG (getStaticPaths + getStaticProps) |
| JSON-LD | Implemented (Person, TechArticle, SoftwareApplication, etc.) |
| Sitemap/robots | Generated by scripts |

---

## Post-Upgrade Summary (Phases 2–8)

### Phase 2 — Bundle analyzer
- **@next/bundle-analyzer** installed and wired in `next.config.js` (runs when `ANALYZE=true`).
- Use **`npm run analyze`** (with `ANALYZE=true` on Unix or `set ANALYZE=true` on Windows) or **`next build --webpack`** to get client/node/edge reports in `.next/analyze/`.
- Homepage already uses dynamic imports for below-fold sections (About, TodaysHighlights, CaseStudiesGrid, LabsExperiments, TechStack, Fun, CTA) with `ssr: false` to keep initial JS smaller.

### Phase 3 — Image optimization
- **next/image** used everywhere via the existing **OptimizedImage** wrapper.
- **Custom Netlify loader** (`netlify-image-loader.js`): builds `/.netlify/images?url=...&w=...&q=...&fm=webp` for static export; deployed site gets WebP from Netlify Image CDN.
- **next.config.js**: `images.unoptimized: false`, `loader: 'custom'`, `loaderFile: './netlify-image-loader.js'`, `formats: ['image/avif', 'image/webp']`.
- **Single priority image**: only the About section profile photo uses `priority`; all other usages set `priority={false}` to avoid multiple high-priority images.
- Width, height, and `sizes` set on all images; Netlify build remains compatible (static export + loader).

### Phase 4 — Font optimization
- **Google `<link>` fonts removed** from `_document.tsx`.
- **next/font/google** (Inter, weights 300–700, `display: 'swap'`) applied at root in `_app.tsx` via `inter.className`.
- No render-blocking font requests; layout preserved (same Inter font).

### Phase 5 — LCP
- **LCP element**: Hero text (no hero image). First meaningful image is the About profile photo.
- **Preload**: Homepage preloads `/assets/profile_photo.jpg` via `<link rel="preload" as="image">` in SEOHead when canonical is the homepage.
- Priority image has fixed dimensions; single priority avoids LCP contention.

### Phase 6 — JSON-LD
- **Homepage**: Person schema (name, jobTitle, url, sameAs, worksFor, knowsAbout) already in `generatePersonSchema`.
- **Case studies**: TechArticle schema extended with **headline**, **description**, **datePublished**, **author**, **programmingLanguage** (tech list), **about** (Thing), **keywords** in `generateTechArticleSchema`.
- **Projects**: SoftwareApplication (name, applicationCategory, tech stack, description) in `generateProjectSchema`.
- Injected with `<script type="application/ld+json">` and `JSON.stringify`; no duplicate schema; valid JSON.

### Phase 7 — SEO safety
- Canonical, Open Graph, and Twitter tags remain in SEOHead.
- Sitemap and robots generation unchanged; dynamic routes remain SSG (getStaticPaths + getStaticProps).
- No routes converted to client-only.

### Phase 8 — Architecture
- Pages Router only; no App Router mixing.
- No removed SEO logic; no partial refactors; metadata centralized in SEOHead/schemas.

---

## Final verification

- **Production build**: ✅ `npm run build` succeeds.
- **TypeScript**: ✅ No type errors.
- **Static export**: ✅ All routes export (○ static, ● SSG for case-studies and developer-journal).
- **Images**: ✅ next/image with Netlify loader; one priority image; preload on homepage.
- **Fonts**: ✅ next/font, non-blocking.
- **JSON-LD**: ✅ Person, TechArticle, SoftwareApplication with required fields.
- **SEO**: ✅ Canonicals, OG, Twitter, sitemap, robots intact.

**Expected results:** Faster load (fonts non-blocking, single LCP preload, WebP images), minimal JS (existing dynamic imports), strong structured data, all current SEO preserved. For bundle analysis run `ANALYZE=true npm run analyze` (or `npm run analyze` with `ANALYZE=true` set in the environment).
